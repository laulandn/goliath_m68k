/*  Metrowerks Standard Library  *//*  $Date: 2000/05/18 20:06:45 $  *  $Revision: 1.2.12.4 $  *  $NoKeywords: $  * *		Copyright © 1995-1999 Metrowerks, Inc. *		All rights reserved. */ /* *	File:		utime.c * *	Content:	Interface file to standard UNIX-style entry points ... * *///#include <cstdlib>//#include <cstdarg>//#include <cwchar>#define WIN32_LEAN_AND_MEAN#include <windows.h>#include <cerrno>#include <fcntl.h>#include <utime.h>//#include <ctime>//#include <unistd.h>static int Time2FileTime(time_t *time, FILETIME *filetime){	struct tm *tm;	SYSTEMTIME systemtime;	FILETIME   localfiletime;		if (!(tm = localtime(time))) return -1;		systemtime.wYear 	= tm->tm_year + 1900;	systemtime.wMonth 	= tm->tm_mon + 1;	systemtime.wDay 	= tm->tm_mday;	systemtime.wHour	= tm->tm_hour;	systemtime.wMinute	= tm->tm_min;	systemtime.wSecond 	= tm->tm_sec;	systemtime.wMilliseconds = 0;		if (!SystemTimeToFileTime(&systemtime,&localfiletime)  ||		!LocalFileTimeToFileTime(&localfiletime,filetime)) 		return -1;	return 0;}/* *	Set the file time stamps. */int utime(const char *path, struct utimbuf *times){	int fh;	struct utimbuf defaulttimes;	FILETIME  lastwrite, lastaccess;	extern long _get_osfhandle(int filehandle);		if (!times) {		time(&defaulttimes.modtime);		defaulttimes.actime = defaulttimes.modtime;		times = &defaulttimes;	}	if (Time2FileTime(&times->modtime,&lastwrite) == -1 ||		Time2FileTime(&times->actime,&lastaccess) == -1) {		errno = -1;		return -1;	}		if ((fh = _open(path,O_RDWR | O_BINARY)) < 0) {		errno = -1;		return -1;	}		if (!SetFileTime((HANDLE) _get_osfhandle(fh),NULL,&lastaccess,&lastwrite)) {		close(fh);		errno = -1;		return (-1);	}			close(fh);	return 0;}/* *	Set the file time stamps. */int utimes(const char */*path*/, struct timeval /*buf*/[2]) /* hh 980122 commented out unused args */{	return (-1);}/*hh 980122 Replaced <windows.h> with the following TWO includes because it is seriously          broken.  The following 2 includes must be carefully ordered as shown, because          they are broken too.hh 980122 commented out unused argsmf 980622 cleaned up including of header files.  preventing inclusion of windows.hcc 000209 changed windef.h to #define WIN32_LEAN_AND_MEAN & #include <windows.h> cc 000518 fixed #includes*/