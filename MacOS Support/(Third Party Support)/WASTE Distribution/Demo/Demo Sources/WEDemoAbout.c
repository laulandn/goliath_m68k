/* *	WASTE Demo Project: *	About Box * *	Copyright © 1993-2002 Marco Piovanelli *	All Rights Reserved * *	Original C Port by John C. Daub * *	<mailto:waste@merzwaren.com> *	<http://www.merzwaren.com/waste/> */#ifndef __WEDEMO__#include "WEDemo.h"#endifstatic pascal OSStatus HandleButton ( EventHandlerCallRef inHandlerCallRef, EventRef inEvent, void * inUserData ){#pragma unused ( inHandlerCallRef, inEvent )	ControlRef			button = ( ControlRef ) inUserData ;	/* quit the modal loop for the enclosing window */	return QuitAppModalLoopForWindow ( GetControlOwner ( button ) ) ;}static pascal void TextScroller ( EventLoopTimerRef inTimer, void * inUserData ){#pragma unused ( inTimer )	WindowRef			window = ( WindowRef ) inUserData ;	IdleControls ( window ) ;}OSStatus DoAboutBox ( void ){	const EventTypeSpec			buttonEventTypes [ ] =	{		{ kEventClassControl,	kEventControlHit }	} ;	const Rect				windowBounds = { 0, 0, 250, 400 } ;	const Rect				boxBounds = { 20, 20, 200, 400 - 20 } ;	const Rect				okButtonBounds = { 217, 317, 217 + 20, 317 + 70 } ;	const ResID				kCreditsTextID = 256 ;	const UInt32			kDelayBeforeAutoScroll = 120 ;	const UInt32			kDelayBetweenAutoScroll = 2 ;	const UInt16			kAutoScrollAmount = 1 ;	WindowRef				window = NULL ;	ControlRef				rootControl = NULL ;	ControlRef				scrollingBox = NULL ;	ControlRef				okButton = NULL ;	EventHandlerUPP			buttonHandler = NULL ;	EventHandlerRef			buttonHandlerRef = NULL ;	EventLoopTimerUPP		scroller = NULL ;	EventLoopTimerRef		timerRef = NULL ;	OSStatus				err ;	HiliteMenu ( 0 ) ;	/* create the window */	if ( ( err = CreateNewWindow ( kMovableModalWindowClass, kWindowStandardHandlerAttribute,		& windowBounds, & window ) ) != noErr )	{		goto cleanup ;	}	if ( ( err = SetWindowTitleWithCFString ( window, CFSTR ( "About WASTE" ) ) ) != noErr )	{		goto cleanup ;	}	if ( ( err = SetThemeWindowBackground ( window, kThemeBrushDialogBackgroundActive, false ) ) != noErr )	{		goto cleanup ;	}	/* establish an embedding hierarchy for controls within this window */	if ( ( err = CreateRootControl ( window, & rootControl ) ) != noErr )	{		goto cleanup ;	}	/* create a scrolling box control */	if ( ( err = CreateScrollingTextBoxControl ( window, & boxBounds, kCreditsTextID, true, kDelayBeforeAutoScroll,		kDelayBetweenAutoScroll, kAutoScrollAmount, & scrollingBox ) ) != noErr )	{		goto cleanup ;	}	/* create the OK button */	if ( ( err = CreatePushButtonControl ( window, & okButtonBounds, CFSTR ( "OK" ), & okButton ) ) != noErr )	{		goto cleanup ;	}	/* make this the 'default' button */	if ( ( err = SetWindowDefaultButton ( window, okButton ) ) != noErr )	{		goto cleanup ;	}	/* associate a handler to the button */	if ( ( err = InstallControlEventHandler ( okButton, buttonHandler = NewEventHandlerUPP ( HandleButton ),		GetEventTypeCount ( buttonEventTypes ), buttonEventTypes, okButton, & buttonHandlerRef ) ) != noErr )	{		goto cleanup ;	}	/* create a timer for calling IdleControls (is this really necessary?) */	if ( ( err = InstallEventLoopTimer ( GetCurrentEventLoop ( ), TicksToEventTime ( kDelayBeforeAutoScroll ),		TicksToEventTime ( kDelayBetweenAutoScroll ), scroller = NewEventLoopTimerUPP ( TextScroller ), window, & timerRef ) ) != noErr )	{		goto cleanup ;	}	/* reposition the window */	if ( ( err = RepositionWindow ( window, NULL, kWindowAlertPositionOnMainScreen ) ) != noErr )	{		goto cleanup ;	}	/* show the window */	if ( ( err = TransitionWindow ( window, kWindowZoomTransitionEffect, kWindowShowTransitionAction, NULL ) ) != noErr )	{		goto cleanup ;	}	/* enter a modal loop for the about box window */	if ( ( err = RunAppModalLoopForWindow ( window ) ) != noErr )	{		goto cleanup ;	}	/* clear result code */	err = noErr ;cleanup :	if ( timerRef != NULL )	{		RemoveEventLoopTimer ( timerRef ) ;	}	if ( scroller != NULL )	{		DisposeEventLoopTimerUPP ( scroller ) ;	}	if ( buttonHandlerRef != NULL )	{		RemoveEventHandler ( buttonHandlerRef ) ;	}	if ( buttonHandler != NULL )	{		DisposeEventHandlerUPP ( buttonHandler ) ;	}	if ( window != NULL )	{		DisposeWindow ( window ) ;	}	/* return result code */	return err ;}