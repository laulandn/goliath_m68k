/*  Metrowerks Standard Library  *//*  $Date: 2000/05/10 20:26:36 $  *  $Revision: 1.3.10.1 $  *  $NoKeywords: $  * *		Copyright © 1995-2000 Metrowerks, Inc. *		All rights reserved. *//* *	FSp_fopen.c *	 *	Routines *	-------- *		FSp_fopen * *	Description *	----------- * *		This function is essentially a variant of fopen that takes an FSSpec instead of a *		pathname. It takes an FSSpec and opens the file with FSpOpenDF. It then uses *		__handle_open to attach the file to an ANSI file stream. * */#include <Errors.h>#include <Files.h>#include <Script.h>#include <file_io.h>#include <FSp_fopen.h>#include <unix.mac.h>				/* mm 990222 */#if defined(__cplusplus) && defined(_MSL_USING_NAMESPACE)	using namespace std;#endifFILE * FSp_fopen(ConstFSSpecPtr spec, const char * open_mode){	__file_modes		mode;	short				permission;	OSErr				ioResult;	short				refNum;	OSType				file_type;	OSType				creator;			/* mm 990222 */	FILE *				file;		if (!__get_file_modes(open_mode, &mode))		return(NULL);		permission = (mode.io_mode == __read) ? fsRdPerm : fsRdWrPerm;		ioResult = FSpOpenDF(spec, permission, &refNum);		if (ioResult)	{		if (ioResult != fnfErr || mode.open_mode == __must_exist)			return(NULL);				file_type = __gettype(mode.binary_io);			/* mm 990222 */		creator   = __getcreator(mode.binary_io);		/* mm 990222 */				if (!(ioResult = FSpCreate(spec, creator, file_type, smSystemScript)))			ioResult = FSpOpenDF(spec, permission, &refNum);				if (ioResult)			return(NULL);	}	else if (mode.open_mode == __create_or_truncate)	{		ioResult = SetEOF(refNum, 0);				if (ioResult)		{			FSClose(refNum);			return(NULL);		}	}		file = __handle_open(refNum, open_mode);		if (!file)		FSClose(refNum);		return(file);}/*     Change record *	13-Dec-95 JFH  First code release. *	30-Dec-95 JFH  Added explicit #includes of <Errors.h> and <Script.h> *  mm 990222	Modified to set type and creator from unix.mac.c * JWW 000510	Compiles correctly with the C++ compiler (even though this is a .c file :-)*/