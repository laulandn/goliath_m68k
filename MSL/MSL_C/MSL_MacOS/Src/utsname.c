/*  Metrowerks Standard Library  *//*  $Date: 2000/06/27 14:52:29 $  *  $Revision: 1.3.10.3 $  *  $NoKeywords: $  * *		Copyright © 1995-2000 Metrowerks, Inc. *		All rights reserved. *//* *	File:		utsname.c * *	Content:	Interface file to standard UNIX-style entry points ... * *	NB:			This file implements some UNIX low level support.  These functions *				are not guaranteed to be 100% conformant. */#include <utsname.h>#include <TextUtils.h>  /* mf 100597 */#include <errno.h>#include <stdio.h>#include <string.h>#include <Gestalt.h>#include <LowMem.h>#include <OSUtils.h>#include <ToolUtils.h>#include <Traps.h>#include <MacTypes.h>	/*  990421 vss  *//* *	int uname(struct utsname *name) * *		Returns information about the current system. */int _uname(struct utsname *name){	static char		macname[] = "MacOS";	long			system, machine;	short			num, savemap;	Str255			string;	StringHandle	h;	OSErr			err = noErr;	if (name) {		memset(name, '\0', sizeof(struct utsname));		strcpy(name->sysname, macname);	#if !TARGET_API_MAC_CARBON		if (GetToolTrapAddress(_Gestalt) != GetToolTrapAddress(_Unimplemented)) {	#else		#pragma unused(savemap)	#endif /* !TARGET_API_MAC_CARBON */			if (((err = Gestalt(gestaltSystemVersion, &system)) == noErr) && ((err = Gestalt(gestaltMachineType, &machine)) == noErr)) {			#if !TARGET_API_MAC_CARBON				savemap = LMGetCurMap();				LMSetCurMap(0);						/* search only in the system file's resources */			#endif /* !TARGET_API_MAC_CARBON */				h = GetString(-16413);				/* the sharing setup machine name */				err = ResError();			#if !TARGET_API_MAC_CARBON				LMSetCurMap(savemap);			#endif /* !TARGET_API_MAC_CARBON */				if (h && err == noErr) {					HLock((Handle)h);					sprintf(name->nodename, "%#.*s", _UTSNAME_FIELD_LENGTH-1, *h);	/* mm 990104 */					HUnlock((Handle)h);				}				num = (system & 0xff00) >> 8;				sprintf(name->release, "%hx", num);				num = (system & 0xff);				sprintf(name->version, "%hx", num);				GetIndString(string, kMachineNameStrID, machine);				sprintf(name->machine, "%#.*s", _UTSNAME_FIELD_LENGTH-1, string);	/* mm 990104 */				if (err != noErr)					errno = err;				return (0);			}	#if !TARGET_API_MAC_CARBON		}	#endif /* !TARGET_API_MAC_CARBON */	}	/* if we reach here we have an error */	errno = err;	return (-1);}/*     Change record *  mf971006    added fixes to compile w/ 3.0.1  universal headers *  mm 990104	Made use of _UTSNAME_FIELD_LENGTH instead of a magic number. * vss 990421	Update to 3.2 Universal Headers *  cc 991108	added ra Carbon Changes done 990611 *  cc 991109   changed TARGET_CARBON to TARGET_API_MAC_CARBON *  cc 991115	updated and deleted outdated comments */