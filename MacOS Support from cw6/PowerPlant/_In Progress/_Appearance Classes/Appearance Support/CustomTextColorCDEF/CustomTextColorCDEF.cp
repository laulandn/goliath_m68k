// ===========================================================================//	CustomTextColorCDEF.cp		PowerPlant 2.1		©1998-1999 Metrowerks Inc.// ===========================================================================////	Control which executes a callback function when receiving a request//	to apply the text color for embedded controls////	The Mac OS 8.5 Control Manager does not provide a way to set the//	text color for individual controls. It sets the text color according//	to the current theme and control embedding hierarchy. PP does not use//	the Control Manager's embeddding hierarchy since it is incompatible//	with how PP adjusts the coordinate system for Panes and Views. Therefore,//	the text color for embedded controls does not get set properly.////	To workaround this problem, PP creates a single CustomTextColor control//	for each window that contains new (Appearance Manager) controls. The//	CustomTextColor control is the container for all other controls. The//	Control Manager calls the container control to apply the text color//	for its embedded controls.////	In response to the kControlMsgApplyTextColor message, the//	CustomTextColor executes a callback function whose UPP is stored//	in the control's refcon.////	Users should not need to create such a control. LAMControlImp creates//	one of these controls per window automatically.////		CustomTextColorUPP	textColorUPP =//								NewCustomTextColorProc(CustomTextColorProc);////		ControlHandle  myControl = ::NewControl(//										myWindowPtr,//										&myFrame,//										Str_Empty,		// Title//										true,			// Visible//										0,				// Value//										0,				// Minimum//										0,				// Maximum//										cdefProc_CustomTextColor,//										(SInt32) textColorUPP);#include <CustomTextColorCDEF.h>#include <UTBAccessors.h>// ---------------------------------------------------------------------------pascal long	CustomTextColorCDEFmain(	SInt16					/* inVarCode */,	ControlHandle			inMacControlH,	ControlDefProcMessage	inMessage,	SInt32					inParam){	long	result = 0;	switch (inMessage) {		case kControlMsgTestNewMsgSupport:	// We support new messages			result = kControlSupportsNewMessages;			break;		case kControlMsgGetFeatures:		// Must support embedding and											//   and special background in											//   order to get message to											//   apply the text color			result = kControlSupportsEmbedding +						kControlHasSpecialBackground;			break;		case kControlMsgApplyTextColor: {	// We store the UPP to our											//   callback function for											//   setting the text color in											//   the control's refcon			CustomTextColorUPP	theUPP =				(CustomTextColorUPP) ::GetControlReference(inMacControlH);			if (theUPP != nil) {				CallCustomTextColorProc(theUPP, inMacControlH, inParam);			}			break;		}		case calcCntlRgn: {					// We are just a rectangle			Rect	bounds;			::GetControlBounds(inMacControlH, &bounds);			::RectRgn((RgnHandle) inParam, &bounds);			break;		}	}	return result;}