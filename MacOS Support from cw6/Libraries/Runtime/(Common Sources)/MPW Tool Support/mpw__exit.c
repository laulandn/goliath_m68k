/***	mpw__exit.c*	Copyright 1995-1997 Metrowerks, Inc. All rights reserved.**	support for calling the CW ANSI libs from CW MPW tools**	The ANSI libs have the following copyright notice.  *	Copyright (c) 1994 by P.J. Plauger.  ALL RIGHTS RESERVED. *	Consult your license regarding permissions and restrictions.**/#if !defined(Using_StdCLib)#include <stdio.h>#include <stdlib.h>#if __MWERKS__#ifndef powerc#pragma segment Main#endifvoid (__exit)(void); // this func will be passed to atexit in the startup code#ifndef __MODENALIB__ 	/*plauger*/void _Closreg(void);		/* macros */#define NATS	32Lvoid (*_MWERKS_Atfuns[NATS])(void) = {0};size_t _MWERKS_Atcount = {NATS};void (__exit)(void){	while (_MWERKS_Atcount < NATS) {		(*_MWERKS_Atfuns[_MWERKS_Atcount++])();	}}int _atexit(void (*)(void));int (_atexit)(void (*func)(void))	{	/* these functions are always called last on the Macintosh */	if (_MWERKS_Atcount == 0)		return (-1);	/* list is full */	_Closreg();	/* register file closings first */	_MWERKS_Atfuns[--_MWERKS_Atcount] = func;	return (0);	}#else /* MSL */#include "critical_regions.h"#define max_funcs	64__extern_cextern void (* __stdio_exit)  (void);static void (*__atexit_funcs[max_funcs])(void);static long	__atexit_curr_func = 0;int		__atexit(void (* func)(void));void	__exit(void);__end_extern_cvoid (__exit)(void){	while (__atexit_curr_func > 0)		(*__atexit_funcs[--__atexit_curr_func])();	if (__stdio_exit)	{		(*__stdio_exit)();		__stdio_exit = 0;	}}int (__atexit)(void (*func)(void)){		if (__atexit_curr_func == max_funcs)		return(-1);		__atexit_funcs[__atexit_curr_func++] = func;		return(0);}#endif /* __MODENALIB__ */#endif#endif