/*  Metrowerks Standard Library  *//*  $Date: 2000/06/27 14:52:26 $  *  $Revision: 1.4.10.7 $  *  $NoKeywords: $  * *		Copyright © 1995-2000 Metrowerks, Inc. *		All rights reserved. */ /* *	File:		unix.c * *	Content:	Interface file to standard UNIX-style entry points ... * *	NB:			This file implements some UNIX low level support.  These functions *				are not guaranteed to be 100% conformant. * */#include <unix.h>#include <cerrno>/*#include <csignal>*/#include <cstring>#include "ansi_files.h"#include "file_io.h"#include <MacTypes.h>	/* 990421  vss */#include <Errors.h>#include <Files.h>#include <Gestalt.h>#include <Traps.h>#include <OSUtils.h>/* function prototypes (exported) */long __getcreator(long isbinary);long __gettype(long isbinary);int  __ctopstring(const char *cstring, Str255 pstring);int  __system7present(void);long __myraise(long signal);/* non-local globals */long	_fcreator = 0L, _ftype = 0L;		/* Creator and Type for files created by the open function *//* *	int __system7present(void) *	 *		Determines if System 7 is present. */int __system7present(void){	static int system7present = -1;		/* we only need to check once */		if (system7present < 0) {		system7present = 0;	#if !TARGET_API_MAC_CARBON		if (GetToolTrapAddress(_Gestalt) != GetToolTrapAddress(_Unimplemented))	#endif /* !TARGET_API_MAC_CARBON */		{			long response;			if (Gestalt(gestaltSystemVersion, &response) == noErr)				system7present = response >= 0x0700;		}	}		return(system7present);}/* *	int __ctopstring(const char *cstring, Str255 pstring) * *		Converts a cstring into a pascal string. */int __ctopstring(const char *cstring, Str255 pstring){	int				i;	unsigned int	len; 	len = strlen(cstring);	if (len > 255)		return (-1);	pstring[0] = len;	for (i = 1; *cstring; i++)		pstring[i] = *cstring++;	return (0);}/* *	long __getcreator(long isbinary) * *		Returns the creator to use for a file. */long __getcreator(long isbinary){	if (_fcreator)		return (_fcreator);	else if (isbinary)#if __MOTO__		return ('???\?');#else		return ('????');#endif	else		return ('CWIE');}/* *	long __gettype(long isbinary) * *		Returns the type to use for a file. */long __gettype(long isbinary){	if (_ftype)		return (_ftype);	else if (isbinary)		return ('BINA');	else		return ('TEXT');}/* *	FILE *fdopen(int fildes, char *type) * *		Converts a fileid into an ANSI C file stream. */FILE *_fdopen(int fildes, char *type){	FILE			*str;	Str255			fname;	FCBPBRec		fcbpb;	OSErr			err;		fcbpb.ioFCBIndx = 0;	fcbpb.ioRefNum = fildes;	fcbpb.ioNamePtr = (StringPtr)fname;	err = PBGetFCBInfoSync(&fcbpb);	if (err != noErr) {		errno = err; return (0);	}	switch (*type) {		case 'w':		case 'a':			if ((fcbpb.ioFCBFlags & 0x0100) == 0) {				errno = paramErr; return (0);			}			break;		case 'r':		/* under non-file sharing file system, an open file always has read access */		default:			break;	}		if (!(str = __find_unopened_file()))		return(0);		return(__handle_reopen(fildes, type, str));}/* int chmod(const char *path, mode_t mode); * Set the file permission bits, the set userID bit and the set group ID bit for the * file named by path to mode.  The permission bits have no application on the Mac * and the other bits are not used on the Mac so this is a dummy placeholder function * to prevent compile and linki errors. */int _chmod(const char *path, mode_t mode)    			/* mm 990115 */{														/* mm 990115 */#pragma unused(path, mode)								/* mm 990115 */	return -1;											/* mm 990115 */}														/* mm 990115 */ /*  Change Record *	12-Oct-95  JFH	Modified to interface to new ANSI C library *	30-Dec-95  JFH  Removed uses of OLDROUTINENAMES 961221 line 111 bkoz added wrapper for moto (mmoss) * hh 990124 removed __std 8 places * vss 990421	Update to 3.2 Universal Headers *  cc 991108	added ra Carbon Changes done 990611 *  cc 991109   changed TARGET_CARBON to TARGET_API_MAC_CARBON *  cc 991115	updated and deleted outdated comments * JWW 000404   removed fileno() function since it's common code now *  cc 000517   changed #includes */