/* *	Startup.c		-	Default init/startup/termination routines for Metrowerks C++ (PowerPC) * *	Copyright © 1993-2002 Metrowerks Corporation.  All Rights Reserved. * */#include <NMWException.h>#include <Quickdraw.h>#include <SegLoad.h>#define __SETJMP_NOT_INTERNAL__#include <setjmp.h>#include <stdlib.h>	/*	external data	*/extern char __code_start__[];				/*	(defined by linker)	*/extern char	__code_end__[];					/*	(defined by linker)	*/extern char __data_start__[];				/*	(defined by linker)	*/extern char __data_end__[];					/*	(defined by linker)	*/extern char __exception_table_start__[];	/*	(defined by linker)	*/extern char __exception_table_end__[];		/*	(defined by linker)	*/	/*	public data		*/char **ArgV;						/*	pascal support for IntEnv glue	*/char **_EnvP;						/*	pascal support for IntEnv glue	*/long ArgC;							/*	pascal support for IntEnv glue	*/	/*	prototypes	*/#ifdef __cplusplusextern "C" {#endifint main(long argc, char **argv, char **envp);void __sinit(void);int __start(void);#ifdef __cplusplus}#endif/* *	__RTOC	-	return the TOC pointer for our code fragment * */static asm char *__RTOC(void){		mr		r3,RTOC	#if !defined(__MWERKS__)			blr	#endif}/* *	__start	-	Default startup routine for Metrowerks C++ (PowerPC) MPW Tools (C only) * *	This routine should be specified as the PEF main routine in the container *	for any monolithic MPW Tool (uses only the normal toolbox shared libs).  *	You should not have an initialize or terminate entry point with this runtime lib. * *	1.	Set up a jmp_buf (exported from StdCLib) for exit() to jump to *	2.	Call all static initializers--these might call exit() *	3.	Set up default values for 'argc' and 'argv' and call main() *	4.	Execute any atexit() routines (via your calling exit()) *	5.	Destroy all static objects *	6.	Execute any cleanup code, e.g. close open files, console window, etc. in *		the event you didn't call exit yourself *	7.	Terminate the MPW Tool * *	This StdCLib version of the runtime does not use the CW ANSI libs and therefore *	does not have a non-standard _atexit() routine.  Also, since this version *	does not support C++ native tools, __destroy_global_chain() does nothing. * */int __start(void){	extern	int		__NubAt3;	extern	void	_BreakPoint(void);	extern	int		__C_phase;	extern	int		_exit_status;	extern	jmp_buf	__target_for_exit;#pragma options align=mac68k	extern	struct {				short	unknown;				long	ArgC;				char	**ArgV;				char	**EnvP;			} _IntEnv;#pragma options align=reset			int		ret = 0;	char *argv = 0;	int fragmentID;		//	register this code fragment with the Exception Handling mechanism	fragmentID = __register_fragment(__code_start__, __code_end__,									__data_start__, __data_end__,									__exception_table_start__, __exception_table_end__,									__RTOC());	if (__NubAt3 != 0) {		_BreakPoint();	}		__C_phase = 2;			//	pascal support for IntEnv glue.	ArgC = _IntEnv.ArgC;	ArgV = _IntEnv.ArgV;	_EnvP = _IntEnv.EnvP;	if (setjmp(__target_for_exit) == 0) {	//	set up jmp_buf for exit()		if (atexit(&__destroy_global_chain)) {			exit(1);		}		__sinit();						//	call all static initializers		_exit_status = main(_IntEnv.ArgC, _IntEnv.ArgV, _IntEnv.EnvP);		exit(_exit_status);				// this will jump to setjmp following the atexit_hook()	}		//	unregister this code fragment with the Exception Handling mechanism	__unregister_fragment(fragmentID);	return(_exit_status);}